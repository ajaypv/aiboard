name = "agent-template"
main = "worker/worker.ts"
compatibility_date = "2024-12-30"
compatibility_flags = ["nodejs_compat"]
assets = { not_found_handling = "single-page-application" }
preview_urls = true

[observability]
enabled = true

[[routes]]
pattern = "agent.templates.tldraw.dev"
custom_domain = true

# Set up the durable object used for each tldraw room
[durable_objects]
bindings = [
    { name = "AGENT_DURABLE_OBJECT", class_name = "AgentDurableObject" },
    { name = "VOICE_DURABLE_OBJECT", class_name = "VoiceDurableObject" },
    { name = "ChatAgent", class_name = "ChatAgent" },
    { name = "PlannerAgent", class_name = "PlannerAgent" },
    { name = "ExecutorAgent", class_name = "ExecutorAgent" },
    { name = "VerifierAgent", class_name = "VerifierAgent" },
]

# Cloudflare AI binding for speech-to-text
[ai]
binding = "AI"

# Durable objects require migrations to create/modify/delete them
[[migrations]]
tag = "v1"
new_classes = ["AgentDurableObject"]

[[migrations]]
tag = "v2"
new_classes = ["VoiceDurableObject"]

[[migrations]]
tag = "v3"
new_sqlite_classes = ["ChatAgent"]

[[migrations]]
tag = "v4"
new_sqlite_classes = ["PlannerAgent", "ExecutorAgent", "VerifierAgent"]
